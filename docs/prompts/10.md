# Runtime QA Findings – Blank 3D Scene, Text‑Only UI

Context: When launching at http://localhost:5174, the screen shows HUD‑like text (SCORE, HIGH SCORE, WAVE, etc.) top‑left, but no 3D scene (no starfield, ship, or asteroids). See screenshot provided.

Goal for CC: Diagnose and fix so the initial experience reliably shows the intended screen (Main Menu → Start Game → 3D scene with starfield and entities). Implement small, safe changes with clear logs and guards.

## Observed Behavior
- Text‑only UI elements render (labels such as SCORE, HIGH SCORE, WAVE, LIVES, Enemies, Asteroids).
- No Three.js canvas content visible behind the UI.
- Time counter increases (e.g., Time: 0:26), suggesting a loop is running somewhere, but gameplay entities are absent.

## Likely Causes (with code references)
1) Game starts in a HUD state without going through Start Menu
- File: `src/framework/game/Game.tsx`
- HUD renders when `currentState === 'playing' || 'paused'`. If Main Menu did not appear, `currentState` likely jumped to `playing` before `handleStartGame` ran.
- `handleStartGame` is the only path that spawns the ship and starts the first wave. If state flips to `playing` but this function didn’t execute (or ran before systems were ready), you get HUD with no entities.

2) Start clicked before systems/scene are ready
- File: `src/framework/game/Game.tsx`
- Systems are initialized in a `useEffect` once `threeScene.sceneRefs.current?.scene` and `camera` exist. If Start is clicked early, `entityManager` or `scene` can be null, and the handler warns and returns (no spawn), but state may still become `playing` later through some side effect.

3) Canvas present but visually occluded
- Z‑index order looks correct (`canvas` zIndex 0, overlays zIndex 10), but if renderer never attached or composer not rendering, the background remains dark. Missing logs can mask this.

4) Wrong mode selected
- `src/game/App.tsx` supports multiple modes (`1` entities test, `2` UI test, `3` complete game). If the “Complete Game” mode wasn’t entered (or exited unexpectedly), you may see UI elements without a running scene.

## What To Implement (do this in a small, verifiable patch)
A) Add a systemsReady gate and robust logs
- File: `src/framework/game/Game.tsx`
- Add a derived boolean `systemsReady` set to true only when all core systems are created and `threeScene.sceneRefs.current?.scene` and `camera` exist.
- In the UI:
  - Show Main Menu by default.
  - Disable or hide “Start Game” until `systemsReady === true` with a small status (“Initializing…”).
- In `handleStartGame`:
  - If not `systemsReady`, log a console warning and return; do not change state.
  - On success, log each step (ship spawned, wave started, state → playing).

B) Ensure we start in the menu and never auto‑flip to playing
- File: `src/framework/game/Game.tsx`
- Verify initial `currentState` is `'menu'` and only changes to `'playing'` in `handleStartGame`.
- Add a one‑time log on mount to print the initial state and a log on every state change via `onStateChange`.

C) Strengthen Three.js initialization visibility
- File: `src/framework/hooks/useThreeScene.ts`
- On mount, log completion of renderer attach (appendChild) and starfield creation.
- On every `update(deltaTime, …)` tick, if composer is uninitialized or starfield missing, log once with an actionable message.

D) Validation helpers
- File: `src/framework/test/EntitySystemTest.tsx`
- Confirm that when entering the Entities Test (press `1` in `src/game/App.tsx`), “Spawn Ship” then “Spawn Asteroid” always produce visible objects; if not, log sceneRefs status.

## Specific Changes (precise edits CC should make)
1) `src/framework/game/Game.tsx`
- Add `const [systemsReady, setSystemsReady] = useState(false);`
- In the systems init `useEffect`, when all of `scene`, `camera`, and core systems are constructed, call `setSystemsReady(true)`; add logs for each system creation success.
- In the JSX for `MainMenu`, pass a `disabled` state or render a small note if not ready (can wrap inside MainMenu or overlay a simple status near the button).
- In `handleStartGame`, guard on `systemsReady`. If false, `console.warn('[Complete Game] Start blocked: systems not ready'); return;`
- Add a log on initial mount: `console.log('[Complete Game] Initial state:', currentState)`.

2) `src/framework/hooks/useThreeScene.ts`
- After `mountRef.current.appendChild(renderer.domElement);` add: `console.log('[Framework] Renderer attached to DOM');`
- After starfield creation: `console.log('[Framework] Starfield created');`
- In `update`, if `sceneRefs.current?.composer` is undefined, log once: `console.warn('[Framework] Composer not ready; skipping render')`.

3) `src/framework/test/EntitySystemTest.tsx`
- Before starting game loop, assert scene readiness and log explicit errors if mount/scene/camera are missing.

4) Do not change UI/overlay casing or other unrelated code in this patch.

## Acceptance Criteria
- Launch app → see Main Menu with “Start Game” disabled until systems ready, then enabled.
- Clicking Start Game after readiness:
  - Console shows: systems created, ship spawned, wave started, state → playing.
  - 3D starfield is visible behind the UI; ship appears at center; waves spawn as expected.
- If Start is clicked early, the game does not switch to playing and logs a clear warning.
- Entity System Test (mode 1) displays starfield and entities reliably after clicking the buttons.

## Validation Steps (manual)
1) Open DevTools console. Reload.
2) Confirm renderer attach and starfield logs, plus `systemsReady: true` confirmation.
3) Start Game: observe ship/wave spawn logs and visible entities.
4) Try to click Start early during a refresh: verify it is disabled or blocked with a warning.
5) Press `1` to enter Entities Test → Spawn ship and asteroid; verify visuals.
6) Ensure no recurring warnings (“Unknown particle config” should already be fixed by previous patch set).

## Scope & Constraints
- Keep this patch focused on readiness gating and logs. Do not refactor UI systems or overlay casing here.
- Avoid changing public APIs; add only non‑breaking guards and clear logging.
- Ensure no visual regressions when systems are ready.

Please propose diffs for these targeted changes, show them for review, apply, and then provide the validation checklist output.

